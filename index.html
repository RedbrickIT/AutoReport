<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoReport</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <header class="header">
      <h1 class="header__title">AutoReport</h1>
      <p class="header__subtitle">Commuter Incentive Report Generator</p>
    </header>

    <main class="main">

      <!-- ===== HOME ===== -->
      <section id="home-section" class="section">
        <div class="home-cards">
          <button class="home-card" id="home-generate">
            <div class="home-card__icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
              </svg>
            </div>
            <h3 class="home-card__title">Generate Report</h3>
            <p class="home-card__desc">Upload an access log and generate a commuter incentive report</p>
          </button>
          <button class="home-card" id="home-optin">
            <div class="home-card__icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <h3 class="home-card__title">Manage Opt-in Reference</h3>
            <p class="home-card__desc">Build and edit a list of employees and companies for filtering reports</p>
          </button>
        </div>
      </section>

      <!-- ===== REPORT: Upload Access Log ===== -->
      <section id="upload-section" class="section hidden">
        <div class="upload-zone" id="upload-zone">
          <div class="upload-zone__icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
          </div>
          <p class="upload-zone__text">Drag & drop your access log file here</p>
          <p class="upload-zone__hint">or click to browse — .xls and .xlsx supported</p>
          <input type="file" id="file-input" accept=".xls,.xlsx" hidden>
        </div>
        <div id="file-info" class="file-info hidden">
          <span class="file-info__name" id="file-name"></span>
          <button class="file-info__clear" id="clear-file" title="Remove file">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="actions" style="margin-top:16px">
          <button class="btn btn--secondary" id="btn-upload-home">Home</button>
        </div>
      </section>

      <!-- ===== REPORT: Opt-in Upload Prompt ===== -->
      <section id="optin-prompt-section" class="section hidden">
        <h2 class="section__title">Opt-in Reference Data</h2>
        <p class="section__desc">Would you like to upload an opt-in reference list? If provided, only employees on the list will appear in the final report and their company names will be included.</p>
        <div class="upload-zone upload-zone--small" id="optin-upload-zone">
          <div class="upload-zone__icon">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
          </div>
          <p class="upload-zone__text">Upload opt-in reference spreadsheet</p>
          <p class="upload-zone__hint">.xls or .xlsx exported from Manage Opt-in Reference</p>
          <input type="file" id="optin-file-input" accept=".xls,.xlsx" hidden>
        </div>
        <div id="optin-file-info" class="file-info hidden">
          <span class="file-info__name" id="optin-file-name"></span>
          <button class="file-info__clear" id="optin-clear-file" title="Remove file">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="actions" style="margin-top:20px">
          <button class="btn btn--secondary" id="btn-optin-back">Back</button>
          <button class="btn btn--secondary" id="btn-optin-skip">Skip</button>
          <button class="btn btn--primary hidden" id="btn-optin-continue">Continue with Opt-in</button>
        </div>
      </section>

      <!-- ===== REPORT: Prefix Filter ===== -->
      <section id="filter-section" class="section hidden">
        <h2 class="section__title">Filter by Employee Group</h2>
        <p class="section__desc">Select which employee prefixes to include in the report. Only selected groups will appear in the output.</p>
        <div id="prefix-list" class="prefix-list"></div>
        <div class="actions">
          <button class="btn btn--secondary" id="btn-back">Back</button>
          <button class="btn btn--primary" id="btn-generate">Generate Report</button>
        </div>
      </section>

      <!-- ===== REPORT: Results ===== -->
      <section id="results-section" class="section hidden">
        <div class="results-header">
          <h2 class="section__title">Report Results</h2>
          <div class="results-header__actions">
            <button class="btn btn--secondary" id="btn-new-report">New Report</button>
            <button class="btn btn--primary" id="btn-export">Export Spreadsheet</button>
          </div>
        </div>
        <div class="results-meta" id="results-meta"></div>
        <div class="table-wrapper">
          <table class="table" id="results-table">
            <thead>
              <tr>
                <th class="table__th table__th--num">#</th>
                <th class="table__th">Employee Name</th>
                <th class="table__th">Last, First</th>
                <th class="table__th table__th--company">Company</th>
                <th class="table__th table__th--days">Days in Office</th>
              </tr>
            </thead>
            <tbody id="results-body"></tbody>
          </table>
        </div>
      </section>

      <!-- ===== OPT-IN REFERENCE MANAGER ===== -->
      <section id="optin-manager-section" class="section hidden">
        <div class="results-header">
          <h2 class="section__title">Opt-in Reference Manager</h2>
          <div class="results-header__actions">
            <button class="btn btn--secondary" id="btn-optin-home">Home</button>
            <button class="btn btn--danger-outline" id="btn-optin-clear">Clear Data</button>
            <button class="btn btn--primary" id="btn-optin-export">Export Opt-in Reference</button>
          </div>
        </div>
        <p class="section__desc">Upload a spreadsheet to populate the list, or add employees manually. Assign company names, then export.</p>

        <!-- Upload into manager -->
        <div class="upload-zone upload-zone--small" id="optin-mgr-upload-zone">
          <div class="upload-zone__icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
          </div>
          <p class="upload-zone__text">Upload a spreadsheet to import names</p>
          <p class="upload-zone__hint">.xls or .xlsx — raw access logs or opt-in reference files supported</p>
          <input type="file" id="optin-mgr-file-input" accept=".xls,.xlsx" hidden>
        </div>

        <!-- Add employee manually -->
        <div class="add-employee-row">
          <div class="custom-input-group">
            <input type="text" class="custom-input" id="add-name-input" placeholder="Employee name (First Last)">
          </div>
          <div class="custom-input-group">
            <input type="text" class="custom-input" id="add-company-input" placeholder="Company">
          </div>
          <button class="btn btn--primary btn--sm" id="btn-add-employee">Add</button>
        </div>

        <!-- Employee table -->
        <div class="table-wrapper" id="optin-table-wrapper" style="margin-top:16px">
          <table class="table" id="optin-table">
            <thead>
              <tr>
                <th class="table__th table__th--num">#</th>
                <th class="table__th">Employee Name</th>
                <th class="table__th table__th--company">Company</th>
                <th class="table__th table__th--action">Remove</th>
              </tr>
            </thead>
            <tbody id="optin-body"></tbody>
          </table>
        </div>
        <p class="empty-state hidden" id="optin-empty">No employees added yet. Upload a spreadsheet or add names manually above.</p>
      </section>

    </main>
  </div>

  <!-- Custom Modal (info) -->
  <div class="modal-overlay hidden" id="modal-overlay">
    <div class="modal" id="modal">
      <h3 class="modal__title" id="modal-title"></h3>
      <p class="modal__message" id="modal-message"></p>
      <div class="modal__actions">
        <button class="btn btn--primary" id="modal-ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Custom Modal (confirm) -->
  <div class="modal-overlay hidden" id="confirm-overlay">
    <div class="modal" id="confirm-modal">
      <h3 class="modal__title" id="confirm-title"></h3>
      <p class="modal__message" id="confirm-message"></p>
      <div class="modal__actions">
        <button class="btn btn--secondary" id="confirm-cancel">Cancel</button>
        <button class="btn btn--danger-solid" id="confirm-yes">Yes, Clear Data</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay hidden" id="loading-overlay">
    <div class="loading-spinner"></div>
    <p class="loading-text">Processing...</p>
  </div>

  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
